//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../pdfreporter-core/src/org/oss/pdfreporter/engine/query/coresql/ObjectModelMapper.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/util/Collection.h"
#include "java/util/Map.h"
#include "org/oss/pdfreporter/engine/JRDataSource.h"
#include "org/oss/pdfreporter/engine/JRException.h"
#include "org/oss/pdfreporter/engine/JRField.h"
#include "org/oss/pdfreporter/engine/query/coresql/FieldNameMapper.h"
#include "org/oss/pdfreporter/engine/query/coresql/IdField.h"
#include "org/oss/pdfreporter/engine/query/coresql/ObjectModelMapper.h"
#include "org/oss/pdfreporter/engine/query/coresql/model/AbstractUdfValuesResolver.h"
#include "org/oss/pdfreporter/engine/query/coresql/model/CoreDto.h"
#include "org/oss/pdfreporter/engine/query/coresql/model/CoreIdentifierType.h"
#include "org/oss/pdfreporter/engine/query/coresql/model/IUdfValueType.h"
#include "org/oss/pdfreporter/sql/IConnection.h"

@interface OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper () {
 @public
  id<OrgOssPdfreporterEngineJRDataSource> delegate_;
  NSString *fieldPrefix_;
  id<JavaUtilMap> models_;
  id<OrgOssPdfreporterSqlIConnection> connection_;
}

- (NSString *)evaluateAliasWithOrgOssPdfreporterEngineJRField:(id<OrgOssPdfreporterEngineJRField>)field
                                                 withNSString:(NSString *)prefix;

@end

J2OBJC_FIELD_SETTER(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper, delegate_, id<OrgOssPdfreporterEngineJRDataSource>)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper, fieldPrefix_, NSString *)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper, models_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper, connection_, id<OrgOssPdfreporterSqlIConnection>)

inline id<OrgOssPdfreporterEngineJRField> OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_get_ID_FIELD();
static id<OrgOssPdfreporterEngineJRField> OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_ID_FIELD;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper, ID_FIELD, id<OrgOssPdfreporterEngineJRField>)

__attribute__((unused)) static NSString *OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_evaluateAliasWithOrgOssPdfreporterEngineJRField_withNSString_(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper *self, id<OrgOssPdfreporterEngineJRField> field, NSString *prefix);

J2OBJC_INITIALIZED_DEFN(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper)

@implementation OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper

- (instancetype)initWithOrgOssPdfreporterEngineJRDataSource:(id<OrgOssPdfreporterEngineJRDataSource>)delegate
                                               withNSString:(NSString *)fieldPrefix
                                            withJavaUtilMap:(id<JavaUtilMap>)models
                        withOrgOssPdfreporterSqlIConnection:(id<OrgOssPdfreporterSqlIConnection>)connection {
  OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_initWithOrgOssPdfreporterEngineJRDataSource_withNSString_withJavaUtilMap_withOrgOssPdfreporterSqlIConnection_(self, delegate, fieldPrefix, models, connection);
  return self;
}

- (jboolean)next {
  for (id<OrgOssPdfreporterEngineQueryCoresqlModelCoreDto> __strong model in nil_chk([((id<JavaUtilMap>) nil_chk(models_)) values])) {
    [((OrgOssPdfreporterEngineQueryCoresqlModelAbstractUdfValuesResolver *) nil_chk([((id<OrgOssPdfreporterEngineQueryCoresqlModelCoreDto>) nil_chk(model)) getUdfValuesResolver])) discardUdfValues];
    ;
  }
  return [((id<OrgOssPdfreporterEngineJRDataSource>) nil_chk(delegate_)) next];
}

- (id)getFieldValueWithOrgOssPdfreporterEngineJRField:(id<OrgOssPdfreporterEngineJRField>)jrField {
  @try {
    NSString *alias = OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_evaluateAliasWithOrgOssPdfreporterEngineJRField_withNSString_(self, jrField, fieldPrefix_);
    id<OrgOssPdfreporterEngineQueryCoresqlModelCoreDto> model = [((id<JavaUtilMap>) nil_chk(models_)) getWithId:alias];
    NSString *name = [self stripPrefixWithOrgOssPdfreporterEngineJRField:jrField withNSString:JreStrcat("$C", alias, '.')];
    if ([OrgOssPdfreporterEngineQueryCoresqlModelIUdfValueType_class_() isAssignableFrom:[((id<OrgOssPdfreporterEngineJRField>) nil_chk(jrField)) getValueClass]]) {
      return [((OrgOssPdfreporterEngineQueryCoresqlModelAbstractUdfValuesResolver *) nil_chk([((id<OrgOssPdfreporterEngineQueryCoresqlModelCoreDto>) nil_chk(model)) getUdfValuesResolver])) getUdfValueWithOrgOssPdfreporterSqlIConnection:connection_ withNSString:name withNSString:[NSString_class_() cast:[((id<OrgOssPdfreporterEngineJRDataSource>) nil_chk(delegate_)) getFieldValueWithOrgOssPdfreporterEngineJRField:new_OrgOssPdfreporterEngineQueryCoresqlFieldNameMapper_initWithOrgOssPdfreporterEngineJRField_withNSString_(jrField, JreStrcat("$$", alias, [((OrgOssPdfreporterEngineQueryCoresqlModelAbstractUdfValuesResolver *) nil_chk([model getUdfValuesResolver])) getUdfValuesColumnNameSuffix]))]]];
    }
    id<OrgOssPdfreporterEngineQueryCoresqlModelCoreIdentifierType> identifier = [((id<OrgOssPdfreporterEngineQueryCoresqlModelCoreDto>) nil_chk(model)) getIdentifierTypeWithNSString:name];
    if (identifier != nil) {
      NSString *idValue = (NSString *) cast_chk([((id<OrgOssPdfreporterEngineJRDataSource>) nil_chk(delegate_)) getFieldValueWithOrgOssPdfreporterEngineJRField:OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_ID_FIELD], [NSString class]);
      id<JavaUtilCollection> ids = [identifier executeIdentfierQueryWithOrgOssPdfreporterSqlIConnection:connection_ withNSString:idValue];
      return ids;
    }
    else {
      if ([((id<JavaUtilCollection>) nil_chk([model getAliasNameAccessedFields])) containsWithId:name]) {
        return [((id<OrgOssPdfreporterEngineJRDataSource>) nil_chk(delegate_)) getFieldValueWithOrgOssPdfreporterEngineJRField:new_OrgOssPdfreporterEngineQueryCoresqlFieldNameMapper_initWithOrgOssPdfreporterEngineJRField_withNSString_(jrField, JreStrcat("$C$", alias, '_', name))];
      }
      else {
        return [((id<OrgOssPdfreporterEngineJRDataSource>) nil_chk(delegate_)) getFieldValueWithOrgOssPdfreporterEngineJRField:new_OrgOssPdfreporterEngineQueryCoresqlFieldNameMapper_initWithOrgOssPdfreporterEngineJRField_withNSString_(jrField, [model mapComplexTypeNameWithNSString:name])];
      }
    }
  }
  @catch (OrgOssPdfreporterEngineJRException *e) {
    @throw new_OrgOssPdfreporterEngineJRException_initWithNSString_withNSException_(NSString_formatWithNSString_withNSObjectArray_(@"No mapping for field %s with prefix %s", [IOSObjectArray newArrayWithObjects:(id[]){ [((id<OrgOssPdfreporterEngineJRField>) nil_chk(jrField)) getName], fieldPrefix_ } count:2 type:NSObject_class_()]), e);
  }
}

- (NSString *)evaluateAliasWithOrgOssPdfreporterEngineJRField:(id<OrgOssPdfreporterEngineJRField>)field
                                                 withNSString:(NSString *)prefix {
  return OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_evaluateAliasWithOrgOssPdfreporterEngineJRField_withNSString_(self, field, prefix);
}

- (NSString *)stripPrefixWithOrgOssPdfreporterEngineJRField:(id<OrgOssPdfreporterEngineJRField>)field
                                               withNSString:(NSString *)alias {
  NSString *name = [((id<OrgOssPdfreporterEngineJRField>) nil_chk(field)) getName];
  if ([((NSString *) nil_chk(name)) hasPrefix:alias]) {
    return [name substring:((jint) [((NSString *) nil_chk(alias)) length])];
  }
  return name;
}

+ (void)initialize {
  if (self == [OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper class]) {
    OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_ID_FIELD = new_OrgOssPdfreporterEngineQueryCoresqlIdField_init();
    J2OBJC_SET_INITIALIZED(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgOssPdfreporterEngineJRDataSource:withNSString:withJavaUtilMap:withOrgOssPdfreporterSqlIConnection:", "ObjectModelMapper", NULL, 0x1, NULL, "(Lorg/oss/pdfreporter/engine/JRDataSource;Ljava/lang/String;Ljava/util/Map<Ljava/lang/String;Lorg/oss/pdfreporter/engine/query/coresql/model/CoreDto;>;Lorg/oss/pdfreporter/sql/IConnection;)V" },
    { "next", NULL, "Z", 0x1, "Lorg.oss.pdfreporter.engine.JRException;", NULL },
    { "getFieldValueWithOrgOssPdfreporterEngineJRField:", "getFieldValue", "Ljava.lang.Object;", 0x1, "Lorg.oss.pdfreporter.engine.JRException;", NULL },
    { "evaluateAliasWithOrgOssPdfreporterEngineJRField:withNSString:", "evaluateAlias", "Ljava.lang.String;", 0x2, NULL, NULL },
    { "stripPrefixWithOrgOssPdfreporterEngineJRField:withNSString:", "stripPrefix", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "ID_FIELD", "ID_FIELD", 0x1a, "Lorg.oss.pdfreporter.engine.JRField;", &OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_ID_FIELD, NULL, .constantValue.asLong = 0 },
    { "delegate_", NULL, 0x12, "Lorg.oss.pdfreporter.engine.JRDataSource;", NULL, NULL, .constantValue.asLong = 0 },
    { "fieldPrefix_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "models_", NULL, 0x12, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/String;Lorg/oss/pdfreporter/engine/query/coresql/model/CoreDto;>;", .constantValue.asLong = 0 },
    { "connection_", NULL, 0x12, "Lorg.oss.pdfreporter.sql.IConnection;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper = { 2, "ObjectModelMapper", "org.oss.pdfreporter.engine.query.coresql", NULL, 0x1, 5, methods, 5, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper;
}

@end

void OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_initWithOrgOssPdfreporterEngineJRDataSource_withNSString_withJavaUtilMap_withOrgOssPdfreporterSqlIConnection_(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper *self, id<OrgOssPdfreporterEngineJRDataSource> delegate, NSString *fieldPrefix, id<JavaUtilMap> models, id<OrgOssPdfreporterSqlIConnection> connection) {
  NSObject_init(self);
  self->delegate_ = delegate;
  self->fieldPrefix_ = fieldPrefix;
  self->models_ = models;
  self->connection_ = connection;
}

OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper *new_OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_initWithOrgOssPdfreporterEngineJRDataSource_withNSString_withJavaUtilMap_withOrgOssPdfreporterSqlIConnection_(id<OrgOssPdfreporterEngineJRDataSource> delegate, NSString *fieldPrefix, id<JavaUtilMap> models, id<OrgOssPdfreporterSqlIConnection> connection) {
  J2OBJC_NEW_IMPL(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper, initWithOrgOssPdfreporterEngineJRDataSource_withNSString_withJavaUtilMap_withOrgOssPdfreporterSqlIConnection_, delegate, fieldPrefix, models, connection)
}

OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper *create_OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_initWithOrgOssPdfreporterEngineJRDataSource_withNSString_withJavaUtilMap_withOrgOssPdfreporterSqlIConnection_(id<OrgOssPdfreporterEngineJRDataSource> delegate, NSString *fieldPrefix, id<JavaUtilMap> models, id<OrgOssPdfreporterSqlIConnection> connection) {
  J2OBJC_CREATE_IMPL(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper, initWithOrgOssPdfreporterEngineJRDataSource_withNSString_withJavaUtilMap_withOrgOssPdfreporterSqlIConnection_, delegate, fieldPrefix, models, connection)
}

NSString *OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper_evaluateAliasWithOrgOssPdfreporterEngineJRField_withNSString_(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper *self, id<OrgOssPdfreporterEngineJRField> field, NSString *prefix) {
  if ([((NSString *) nil_chk(prefix)) isEqual:@"*"]) {
    jint idx = [((NSString *) nil_chk([((id<OrgOssPdfreporterEngineJRField>) nil_chk(field)) getName])) indexOfString:@"."];
    if (idx > 0) {
      return [((NSString *) nil_chk([field getName])) substring:0 endIndex:idx];
    }
  }
  return prefix;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgOssPdfreporterEngineQueryCoresqlObjectModelMapper)
