//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../pdfreporter-core/src/org/oss/pdfreporter/engine/util/JRSingletonCache.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/lang/ClassNotFoundException.h"
#include "java/lang/IllegalAccessException.h"
#include "java/lang/InstantiationException.h"
#include "java/util/Map.h"
#include "org/oss/pdfreporter/engine/JRException.h"
#include "org/oss/pdfreporter/engine/util/JRClassLoader.h"
#include "org/oss/pdfreporter/engine/util/JRSingletonCache.h"
#include "org/oss/pdfreporter/uses/org/apache/commons/collections/ReferenceMap.h"

@interface OrgOssPdfreporterEngineUtilJRSingletonCache () {
 @public
  OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *cache_;
  IOSClass *itf_;
}

@end

J2OBJC_FIELD_SETTER(OrgOssPdfreporterEngineUtilJRSingletonCache, cache_, OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterEngineUtilJRSingletonCache, itf_, IOSClass *)

inline id OrgOssPdfreporterEngineUtilJRSingletonCache_get_CONTEXT_KEY_NULL();
static id OrgOssPdfreporterEngineUtilJRSingletonCache_CONTEXT_KEY_NULL;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgOssPdfreporterEngineUtilJRSingletonCache, CONTEXT_KEY_NULL, id)

J2OBJC_INITIALIZED_DEFN(OrgOssPdfreporterEngineUtilJRSingletonCache)

@implementation OrgOssPdfreporterEngineUtilJRSingletonCache

- (instancetype)initWithIOSClass:(IOSClass *)itf {
  OrgOssPdfreporterEngineUtilJRSingletonCache_initWithIOSClass_(self, itf);
  return self;
}

- (id)getCachedInstanceWithNSString:(NSString *)className_ {
  @synchronized(self) {
    id<JavaUtilMap> contextCache = [self getContextInstanceCache];
    id instance = [((id<JavaUtilMap>) nil_chk(contextCache)) getWithId:className_];
    if (instance == nil) {
      instance = [self createInstanceWithNSString:className_];
      (void) [contextCache putWithId:className_ withId:instance];
    }
    return instance;
  }
}

- (id)createInstanceWithNSString:(NSString *)className_ {
  @try {
    IOSClass *clazz = OrgOssPdfreporterEngineUtilJRClassLoader_loadClassForNameWithNSString_(className_);
    if (itf_ != nil && ![itf_ isAssignableFrom:clazz]) {
      @throw new_OrgOssPdfreporterEngineJRException_initWithNSString_(JreStrcat("$$$$C", @"Class \"", className_, @"\" should be compatible with \"", [itf_ getName], '"'));
    }
    return [((IOSClass *) nil_chk(clazz)) newInstance];
  }
  @catch (JavaLangClassNotFoundException *e) {
    @throw new_OrgOssPdfreporterEngineJRException_initWithNSString_withNSException_(JreStrcat("$$$", @"Class ", className_, @" not found."), e);
  }
  @catch (JavaLangInstantiationException *e) {
    @throw new_OrgOssPdfreporterEngineJRException_initWithNSString_withNSException_(JreStrcat("$$C", @"Error instantiating class ", className_, '.'), e);
  }
  @catch (JavaLangIllegalAccessException *e) {
    @throw new_OrgOssPdfreporterEngineJRException_initWithNSString_withNSException_(JreStrcat("$$C", @"Error instantiating class ", className_, '.'), e);
  }
}

- (id<JavaUtilMap>)getContextInstanceCache {
  id contextKey = [self getContextKey];
  id<JavaUtilMap> contextCache = (id<JavaUtilMap>) cast_check([((OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *) nil_chk(cache_)) getWithId:contextKey], JavaUtilMap_class_());
  if (contextCache == nil) {
    contextCache = new_OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_init();
    (void) [cache_ putWithId:contextKey withId:contextCache];
  }
  return contextCache;
}

- (id)getContextKey {
  return OrgOssPdfreporterEngineUtilJRSingletonCache_CONTEXT_KEY_NULL;
}

+ (void)initialize {
  if (self == [OrgOssPdfreporterEngineUtilJRSingletonCache class]) {
    OrgOssPdfreporterEngineUtilJRSingletonCache_CONTEXT_KEY_NULL = new_NSObject_init();
    J2OBJC_SET_INITIALIZED(OrgOssPdfreporterEngineUtilJRSingletonCache)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithIOSClass:", "JRSingletonCache", NULL, 0x1, NULL, "(Ljava/lang/Class<TT;>;)V" },
    { "getCachedInstanceWithNSString:", "getCachedInstance", "TT;", 0x21, "Lorg.oss.pdfreporter.engine.JRException;", "(Ljava/lang/String;)TT;" },
    { "createInstanceWithNSString:", "createInstance", "TT;", 0x4, "Lorg.oss.pdfreporter.engine.JRException;", "(Ljava/lang/String;)TT;" },
    { "getContextInstanceCache", NULL, "Ljava.util.Map;", 0x4, NULL, "()Ljava/util/Map<Ljava/lang/String;TT;>;" },
    { "getContextKey", NULL, "Ljava.lang.Object;", 0x4, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "CONTEXT_KEY_NULL", "CONTEXT_KEY_NULL", 0x1a, "Ljava.lang.Object;", &OrgOssPdfreporterEngineUtilJRSingletonCache_CONTEXT_KEY_NULL, NULL, .constantValue.asLong = 0 },
    { "cache_", NULL, 0x12, "Lorg.oss.pdfreporter.uses.org.apache.commons.collections.ReferenceMap;", NULL, NULL, .constantValue.asLong = 0 },
    { "itf_", NULL, 0x12, "Ljava.lang.Class;", NULL, "Ljava/lang/Class<TT;>;", .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgOssPdfreporterEngineUtilJRSingletonCache = { 2, "JRSingletonCache", "org.oss.pdfreporter.engine.util", NULL, 0x1, 5, methods, 3, fields, 0, NULL, 0, NULL, NULL, "<T:Ljava/lang/Object;>Ljava/lang/Object;" };
  return &_OrgOssPdfreporterEngineUtilJRSingletonCache;
}

@end

void OrgOssPdfreporterEngineUtilJRSingletonCache_initWithIOSClass_(OrgOssPdfreporterEngineUtilJRSingletonCache *self, IOSClass *itf) {
  NSObject_init(self);
  self->cache_ = new_OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_initWithInt_withInt_(OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_WEAK, OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_SOFT);
  self->itf_ = itf;
}

OrgOssPdfreporterEngineUtilJRSingletonCache *new_OrgOssPdfreporterEngineUtilJRSingletonCache_initWithIOSClass_(IOSClass *itf) {
  J2OBJC_NEW_IMPL(OrgOssPdfreporterEngineUtilJRSingletonCache, initWithIOSClass_, itf)
}

OrgOssPdfreporterEngineUtilJRSingletonCache *create_OrgOssPdfreporterEngineUtilJRSingletonCache_initWithIOSClass_(IOSClass *itf) {
  J2OBJC_CREATE_IMPL(OrgOssPdfreporterEngineUtilJRSingletonCache, initWithIOSClass_, itf)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgOssPdfreporterEngineUtilJRSingletonCache)
