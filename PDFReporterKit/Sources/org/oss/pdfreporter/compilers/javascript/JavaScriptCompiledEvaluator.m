//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../pdfreporter-core/src/org/oss/pdfreporter/compilers/javascript/JavaScriptCompiledEvaluator.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Exception.h"
#include "java/lang/Integer.h"
#include "java/lang/RuntimeException.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"
#include "java/util/logging/Level.h"
#include "java/util/logging/Logger.h"
#include "org/oss/pdfreporter/compilers/javascript/JavaScriptCompiledData.h"
#include "org/oss/pdfreporter/compilers/javascript/JavaScriptCompiledEvaluator.h"
#include "org/oss/pdfreporter/compilers/javascript/JavaScriptEvaluatorScope.h"
#include "org/oss/pdfreporter/compilers/javascript/factory/IJavaScriptClassLoader.h"
#include "org/oss/pdfreporter/compilers/javascript/factory/IJavaScriptFactory.h"
#include "org/oss/pdfreporter/compilers/javascript/factory/IScript.h"
#include "org/oss/pdfreporter/engine/JRException.h"
#include "org/oss/pdfreporter/engine/JasperReportsContext.h"
#include "org/oss/pdfreporter/engine/fill/JREvaluator.h"
#include "org/oss/pdfreporter/functions/FunctionsUtil.h"
#include "org/oss/pdfreporter/registry/ApiRegistry.h"
#include "org/oss/pdfreporter/uses/org/apache/commons/collections/ReferenceMap.h"

@interface OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator () {
 @public
  id<OrgOssPdfreporterEngineJasperReportsContext> jasperReportsContext_;
  NSString *unitName_;
  OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData *compiledData_;
  OrgOssPdfreporterFunctionsFunctionsUtil *functionsUtil_;
  OrgOssPdfreporterCompilersJavascriptJavaScriptEvaluatorScope *evaluatorScope_;
  id<JavaUtilMap> scripts_;
}

@end

J2OBJC_FIELD_SETTER(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, jasperReportsContext_, id<OrgOssPdfreporterEngineJasperReportsContext>)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, unitName_, NSString *)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, compiledData_, OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData *)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, functionsUtil_, OrgOssPdfreporterFunctionsFunctionsUtil *)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, evaluatorScope_, OrgOssPdfreporterCompilersJavascriptJavaScriptEvaluatorScope *)
J2OBJC_FIELD_SETTER(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, scripts_, id<JavaUtilMap>)

inline JavaUtilLoggingLogger *OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_get_logger();
static JavaUtilLoggingLogger *OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, logger, JavaUtilLoggingLogger *)

inline OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_get_scriptClassLoaders();
static OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_scriptClassLoaders;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, scriptClassLoaders, OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *)

J2OBJC_INITIALIZED_DEFN(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator)

NSString *OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_EXPRESSION_ID_VAR = @"_jreid";

@implementation OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator

+ (NSString *)EXPRESSION_ID_VAR {
  return OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_EXPRESSION_ID_VAR;
}

+ (id<OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptClassLoader>)getScriptClassLoaderWithNSString:(NSString *)unitName {
  return OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_getScriptClassLoaderWithNSString_(unitName);
}

- (instancetype)initWithOrgOssPdfreporterEngineJasperReportsContext:(id<OrgOssPdfreporterEngineJasperReportsContext>)jasperReportsContext
                                                       withNSString:(NSString *)unitName
     withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData:(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData *)compiledData {
  OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_initWithOrgOssPdfreporterEngineJasperReportsContext_withNSString_withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_(self, jasperReportsContext, unitName, compiledData);
  return self;
}

- (void)setJasperReportsContextWithOrgOssPdfreporterEngineJasperReportsContext:(id<OrgOssPdfreporterEngineJasperReportsContext>)context {
  self->functionsUtil_ = OrgOssPdfreporterFunctionsFunctionsUtil_getInstanceWithOrgOssPdfreporterEngineJasperReportsContext_(context);
}

- (void)customizedInitWithJavaUtilMap:(id<JavaUtilMap>)parametersMap
                      withJavaUtilMap:(id<JavaUtilMap>)fieldsMap
                      withJavaUtilMap:(id<JavaUtilMap>)variablesMap {
  evaluatorScope_ = new_OrgOssPdfreporterCompilersJavascriptJavaScriptEvaluatorScope_initWithOrgOssPdfreporterEngineJasperReportsContext_withOrgOssPdfreporterEngineFillJREvaluator_withOrgOssPdfreporterFunctionsFunctionsUtil_(jasperReportsContext_, self, functionsUtil_);
  [evaluatorScope_ init__WithJavaUtilMap:parametersMap withJavaUtilMap:fieldsMap withJavaUtilMap:variablesMap];
}

- (id)evaluateWithInt:(jint)id_ {
  OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_ExpressionIndexes *expression = [self getExpressionWithInt:id_];
  return [self evaluateExpressionWithInt:[((OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_ExpressionIndexes *) nil_chk(expression)) getDefaultExpressionIndex]];
}

- (id)evaluateEstimatedWithInt:(jint)id_ {
  OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_ExpressionIndexes *expression = [self getExpressionWithInt:id_];
  return [self evaluateExpressionWithInt:[((OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_ExpressionIndexes *) nil_chk(expression)) getEstimatedExpressionIndex]];
}

- (id)evaluateOldWithInt:(jint)id_ {
  OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_ExpressionIndexes *expression = [self getExpressionWithInt:id_];
  return [self evaluateExpressionWithInt:[((OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_ExpressionIndexes *) nil_chk(expression)) getOldExpressionIndex]];
}

- (OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_ExpressionIndexes *)getExpressionWithInt:(jint)id_ {
  return [((OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData *) nil_chk(compiledData_)) getExpressionWithInt:id_];
}

- (id)evaluateExpressionWithInt:(jint)expressionIndex {
  jint scriptIndex = OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_scriptIndexWithInt_(expressionIndex);
  id<OrgOssPdfreporterCompilersJavascriptFactoryIScript> script = [((id<JavaUtilMap>) nil_chk(scripts_)) getWithId:JavaLangInteger_valueOfWithInt_(scriptIndex)];
  if (script == nil) {
    [((JavaUtilLoggingLogger *) nil_chk(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger)) finestWithNSString:JreStrcat("$I$I", @"creating script for expression index ", expressionIndex, @", script index ", scriptIndex)];
    id<OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptClassLoader> scriptClassLoader = OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_getScriptClassLoaderWithNSString_(unitName_);
    script = [((id<OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptClassLoader>) nil_chk(scriptClassLoader)) createScriptWithInt:scriptIndex withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData:compiledData_];
    (void) [scripts_ putWithId:JavaLangInteger_valueOfWithInt_(scriptIndex) withId:script];
  }
  jint expressionId = OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_expressionIdWithInt_(expressionIndex);
  [((OrgOssPdfreporterCompilersJavascriptJavaScriptEvaluatorScope *) nil_chk(evaluatorScope_)) setScopeVariableWithNSString:OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_EXPRESSION_ID_VAR withId:JavaLangInteger_valueOfWithInt_(expressionId)];
  @try {
    [((JavaUtilLoggingLogger *) nil_chk(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger)) finestWithNSString:NSString_formatWithNSString_withNSObjectArray_(@"evaluating expression with index: %s (scriptIndex: %s, script: %s) for expressionId: %s", [IOSObjectArray newArrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_(expressionIndex), JavaLangInteger_valueOfWithInt_(scriptIndex), script, JavaLangInteger_valueOfWithInt_(expressionId) } count:4 type:NSObject_class_()])];
    id value = [((OrgOssPdfreporterCompilersJavascriptJavaScriptEvaluatorScope *) nil_chk(evaluatorScope_)) evaluateExpressionWithOrgOssPdfreporterCompilersJavascriptFactoryIScript:script];
    [OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger finestWithNSString:JreStrcat("$I$I$@", @"expression with index ", expressionIndex, @", id ", expressionId, @" evaluated to ", value)];
    return value;
  }
  @catch (JavaLangException *e) {
    [OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger logWithJavaUtilLoggingLevel:JreLoadStatic(JavaUtilLoggingLevel, SEVERE) withNSString:JreStrcat("$I$I", @"Exception evaluating expression with index: ", expressionIndex, @", id: ", expressionId) withNSException:e];
    @throw new_JavaLangRuntimeException_initWithNSException_(e);
  }
}

+ (void)initialize {
  if (self == [OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator class]) {
    OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger = JavaUtilLoggingLogger_getLoggerWithNSString_([OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_class_() getName]);
    OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_scriptClassLoaders = new_OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_initWithInt_withInt_(OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_HARD, OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_SOFT);
    J2OBJC_SET_INITIALIZED(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "getScriptClassLoaderWithNSString:", "getScriptClassLoader", "Lorg.oss.pdfreporter.compilers.javascript.factory.IJavaScriptClassLoader;", 0xc, NULL, NULL },
    { "initWithOrgOssPdfreporterEngineJasperReportsContext:withNSString:withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData:", "JavaScriptCompiledEvaluator", NULL, 0x1, NULL, NULL },
    { "setJasperReportsContextWithOrgOssPdfreporterEngineJasperReportsContext:", "setJasperReportsContext", "V", 0x1, NULL, NULL },
    { "customizedInitWithJavaUtilMap:withJavaUtilMap:withJavaUtilMap:", "customizedInit", "V", 0x4, "Lorg.oss.pdfreporter.engine.JRException;", "(Ljava/util/Map<Ljava/lang/String;Lorg/oss/pdfreporter/engine/fill/IJRFillParameter;>;Ljava/util/Map<Ljava/lang/String;Lorg/oss/pdfreporter/engine/fill/JRFillField;>;Ljava/util/Map<Ljava/lang/String;Lorg/oss/pdfreporter/engine/fill/JRFillVariable;>;)V" },
    { "evaluateWithInt:", "evaluate", "Ljava.lang.Object;", 0x4, "Ljava.lang.Throwable;", NULL },
    { "evaluateEstimatedWithInt:", "evaluateEstimated", "Ljava.lang.Object;", 0x4, "Ljava.lang.Throwable;", NULL },
    { "evaluateOldWithInt:", "evaluateOld", "Ljava.lang.Object;", 0x4, "Ljava.lang.Throwable;", NULL },
    { "getExpressionWithInt:", "getExpression", "Lorg.oss.pdfreporter.compilers.javascript.JavaScriptCompiledData$ExpressionIndexes;", 0x4, NULL, NULL },
    { "evaluateExpressionWithInt:", "evaluateExpression", "Ljava.lang.Object;", 0x4, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "logger", "logger", 0x1a, "Ljava.util.logging.Logger;", &OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger, NULL, .constantValue.asLong = 0 },
    { "EXPRESSION_ID_VAR", "EXPRESSION_ID_VAR", 0x1c, "Ljava.lang.String;", &OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_EXPRESSION_ID_VAR, NULL, .constantValue.asLong = 0 },
    { "scriptClassLoaders", "scriptClassLoaders", 0x1a, "Lorg.oss.pdfreporter.uses.org.apache.commons.collections.ReferenceMap;", &OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_scriptClassLoaders, NULL, .constantValue.asLong = 0 },
    { "jasperReportsContext_", NULL, 0x12, "Lorg.oss.pdfreporter.engine.JasperReportsContext;", NULL, NULL, .constantValue.asLong = 0 },
    { "unitName_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "compiledData_", NULL, 0x12, "Lorg.oss.pdfreporter.compilers.javascript.JavaScriptCompiledData;", NULL, NULL, .constantValue.asLong = 0 },
    { "functionsUtil_", NULL, 0x2, "Lorg.oss.pdfreporter.functions.FunctionsUtil;", NULL, NULL, .constantValue.asLong = 0 },
    { "evaluatorScope_", NULL, 0x2, "Lorg.oss.pdfreporter.compilers.javascript.JavaScriptEvaluatorScope;", NULL, NULL, .constantValue.asLong = 0 },
    { "scripts_", NULL, 0x12, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/Integer;Lorg/oss/pdfreporter/compilers/javascript/factory/IScript;>;", .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator = { 2, "JavaScriptCompiledEvaluator", "org.oss.pdfreporter.compilers.javascript", NULL, 0x1, 9, methods, 9, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator;
}

@end

id<OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptClassLoader> OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_getScriptClassLoaderWithNSString_(NSString *unitName) {
  OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_initialize();
  id<OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptClassLoader> loader;
  jboolean created = false;
  @synchronized(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_scriptClassLoaders) {
    loader = (id<OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptClassLoader>) cast_check([((OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *) nil_chk(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_scriptClassLoaders)) getWithId:unitName], OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptClassLoader_class_());
    if (loader == nil) {
      loader = [((id<OrgOssPdfreporterCompilersJavascriptFactoryIJavaScriptFactory>) nil_chk(OrgOssPdfreporterRegistryApiRegistry_getJavascriptFactory())) newClassLoader];
      (void) [OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_scriptClassLoaders putWithId:unitName withId:loader];
      created = true;
    }
  }
  [((JavaUtilLoggingLogger *) nil_chk(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_logger)) finerWithNSString:JreStrcat("$@$$", @"created script class loader ", loader, @" for ", unitName)];
  return loader;
}

void OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_initWithOrgOssPdfreporterEngineJasperReportsContext_withNSString_withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator *self, id<OrgOssPdfreporterEngineJasperReportsContext> jasperReportsContext, NSString *unitName, OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData *compiledData) {
  OrgOssPdfreporterEngineFillJREvaluator_init(self);
  self->scripts_ = new_JavaUtilHashMap_init();
  self->jasperReportsContext_ = jasperReportsContext;
  self->unitName_ = unitName;
  self->compiledData_ = compiledData;
}

OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator *new_OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_initWithOrgOssPdfreporterEngineJasperReportsContext_withNSString_withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_(id<OrgOssPdfreporterEngineJasperReportsContext> jasperReportsContext, NSString *unitName, OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData *compiledData) {
  J2OBJC_NEW_IMPL(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, initWithOrgOssPdfreporterEngineJasperReportsContext_withNSString_withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_, jasperReportsContext, unitName, compiledData)
}

OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator *create_OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator_initWithOrgOssPdfreporterEngineJasperReportsContext_withNSString_withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_(id<OrgOssPdfreporterEngineJasperReportsContext> jasperReportsContext, NSString *unitName, OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData *compiledData) {
  J2OBJC_CREATE_IMPL(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator, initWithOrgOssPdfreporterEngineJasperReportsContext_withNSString_withOrgOssPdfreporterCompilersJavascriptJavaScriptCompiledData_, jasperReportsContext, unitName, compiledData)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgOssPdfreporterCompilersJavascriptJavaScriptCompiledEvaluator)
